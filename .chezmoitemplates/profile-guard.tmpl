{{- /*
  profile-guard.tmpl - Reusable profile validation and helper definitions

  Usage in templates:
    {{- template "profile-guard" . -}}

  After including, these variables are available:
    - $profile:  Current profile ("macos", "linux", or "mini")
    - $isMacos:  true if profile == "macos"
    - $isLinux:  true if profile == "linux"
    - $isMini:   true if profile == "mini"
    - $hasGUI:        true if GUI apps are expected (macos only)
    - $hasGPG:        true if GPG signing is enabled (macos only)
    - $hasPrivateKey: true if private keys are available (macos only)
    - $hasAgentForward: true if SSH agent forwarding is used (macos and linux)

  Example:
    {{- template "profile-guard" . -}}
    {{- if $isMacos }}
    # macOS-specific configuration
    {{- end }}
*/ -}}

{{- /* Validate and normalize profile */ -}}
{{- $profile := .profile | default "macos" -}}
{{- $validProfiles := list "macos" "linux" "mini" -}}
{{- if not (has $profile $validProfiles) -}}
{{-   $profile = "macos" -}}
{{- end -}}

{{- /* Derived boolean flags */ -}}
{{- $isMacos := eq $profile "macos" -}}
{{- $isLinux := eq $profile "linux" -}}
{{- $isMini := eq $profile "mini" -}}

{{- /* Capability flags based on profile */ -}}
{{- $hasGUI := $isMacos -}}
{{- $hasGPG := $isMacos -}}
{{- $hasPrivateKey := $isMacos -}}
{{- $hasAgentForward := or $isMacos $isLinux -}}
