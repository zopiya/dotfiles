# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
# if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
#   source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
# fi

# Homebrew Configuration
if [[ -x /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
elif [[ -x /usr/local/bin/brew ]]; then
  eval "$(/usr/local/bin/brew shellenv)"
elif [[ -x /home/linuxbrew/.linuxbrew/bin/brew ]]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
elif [[ -x "$HOME/.linuxbrew/bin/brew" ]]; then
  eval "$("$HOME/.linuxbrew/bin/brew" shellenv)"
fi

# Path Configuration
export PATH="$HOME/.local/bin:$PATH"

# Sheldon (Plugin Manager)
if command -v sheldon &> /dev/null; then
    eval "$(sheldon source)"
fi

# Starship (Prompt)
if command -v starship &> /dev/null; then
    eval "$(starship init zsh)"
fi

# Zoxide (Smart Directory Jumper)
if command -v zoxide &> /dev/null; then
    eval "$(zoxide init zsh)"
fi

# Mise (Runtime Manager)
{{- if (get . "install_mise") }}
if command -v mise &> /dev/null; then
    eval "$(mise activate zsh)"
fi
{{- end }}

# FZF
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Load Modular Configs
[ -f "$ZDOTDIR/exports.zsh" ] && source "$ZDOTDIR/exports.zsh"
[ -f "$ZDOTDIR/aliases.zsh" ] && source "$ZDOTDIR/aliases.zsh"
[ -f "$ZDOTDIR/functions.zsh" ] && source "$ZDOTDIR/functions.zsh"

# Security Module (GPG Agent)
{{- if (get . "install_security") }}
if command -v gpgconf &> /dev/null; then
    export GPG_TTY=$(tty)
    export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)
    gpgconf --launch gpg-agent 2>/dev/null || true
fi
{{- end }}

# Syntax Highlighting (must be last)
# source $(brew --prefix)/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
