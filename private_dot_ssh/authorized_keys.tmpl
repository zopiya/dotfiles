{{- /* ==============================================================================
SSH Authorized Keys - Profile Aware
============================================================================== */ -}}
{{- $profile := .profile | default "macos" -}}
{{- $isLinuxProfile := eq $profile "linux" -}}
{{- $isLinuxOS := eq .chezmoi.os "linux" -}}

{{- /*
Logic:
1. Linux OS machines (any profile) always act as SSH hosts -> Need CA Public Key.
2. Explicit 'linux' profile (even if non-Linux OS) -> Need CA Public Key.
3. macOS profile -> Client only, no authorized_keys needed.
4. Mini profile on Linux -> Needs CA Public Key (dev containers accept SSH from host).
*/ -}}

{{- if or $isLinuxOS $isLinuxProfile }}
# === {{ if $isLinuxProfile }}LINUX PROFILE{{ else }}LINUX OS{{ end }}: CA TRUST ===
# Trust the User CA. Any SSH key signed by this CA is allowed to log in.
# Replace the placeholder below with your actual User CA Public Key (e.g., contents of user_ca.pub).
# Format: cert-authority <algorithm> <key-content> [comment]

cert-authority ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINW4wGZTsFp3o2Yy0iO5lNTo45N/nQ/28NRqDgLRJMDb OpenSSH CA of Zopiya Infrastructure

{{- else }}
# === {{ $profile | title }} PROFILE ===
# No authorized_keys managed by chezmoi for this profile.
# (Usually workstation uses local keys to connect OUT, doesn't accept connections IN)
{{- end }}
